#!/bin/bash

# setup-env.sh - Script to configure local development environment
# Usage: ./setup-env.sh [backend_port] [frontend_port]

BACKEND_PORT=${1:-8080}
FRONTEND_PORT=${2:-3000}

# Create .env.local if it doesn't exist
if [ ! -f .env.local ]; then
    echo "Creating .env.local with default configuration..."
    
    cat > .env.local << EOF
# Local development environment configuration
# Generated by setup-env.sh on $(date)

# Backend API URL (adjust if running backend on different port)
NEXT_PUBLIC_API_URL=http://localhost:${BACKEND_PORT}

# WebSocket URL (adjust if running backend on different port)
NEXT_PUBLIC_WS_URL=ws://localhost:${BACKEND_PORT}/api/v2/ws

# Development mode
NODE_ENV=development

# For backend reference (not used by frontend):
# DATABASE_URL=postgresql://domainflow:pNpTHxEWr2SmY270p1IjGn3dP/domainflow_production@localhost:5432
# SESSION_SECRET=your_session_secret_here
EOF

    echo "âœ… Created .env.local with:"
    echo "   - Backend API: http://localhost:${BACKEND_PORT}"
    echo "   - WebSocket: ws://localhost:${BACKEND_PORT}/api/v2/ws"
    echo "   - Frontend: http://localhost:${FRONTEND_PORT}"
else
    echo "âš ï¸  .env.local already exists. Current configuration:"
    grep "NEXT_PUBLIC_API_URL\|NEXT_PUBLIC_WS_URL" .env.local || echo "   No API URLs configured"
fi

echo ""
echo "ðŸ“ You can customize the environment by editing .env.local"
echo "   Common configurations:"
echo "   - Different machine: NEXT_PUBLIC_API_URL=http://192.168.1.100:8080"
echo "   - Docker backend: NEXT_PUBLIC_API_URL=http://host.docker.internal:8080"
echo "   - Remote backend: NEXT_PUBLIC_API_URL=https://api.yourdomain.com"
echo ""
echo "ðŸš€ Start the development servers:"
echo "   Backend:  cd backend && ./bin/apiserver"
echo "   Frontend: npm run dev"
