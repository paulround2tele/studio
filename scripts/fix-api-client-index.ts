#!/usr/bin/env tsx

/*
 * Post-Generation API Client Index Fixer
 * 
 * This script fixes the garbage index.ts file that the OpenAPI generator creates.
 * It properly exports all APIs and models at the top level for professional usage.
 * 
 * WHY THIS IS NEEDED:
 * The OpenAPI generator only exports 3 categories (api, models, configuration)
 * instead of exposing all the individual API classes and model types.
 * This forces amateur import patterns instead of professional ones.
 */

import { writeFileSync, readFileSync } from 'fs';
import path from 'path';

const API_CLIENT_DIR = path.join(process.cwd(), 'src/lib/api-client');
const INDEX_FILE = path.join(API_CLIENT_DIR, 'index.ts');

/**
 * Generate a professional index.ts that exposes everything properly
 */
function generateProfessionalIndex(): string {
  return `/* tslint:disable */
/* eslint-disable */
/**
 * Domain Flow API Client
 * Professional index that exposes all APIs and models properly
 * 
 * Generated by: ${new Date().toISOString()}
 * 
 * NOTE: This file is auto-regenerated after OpenAPI generation.
 * Do not edit manually - your changes will be overwritten.
 */

// ==================================================
// CORE CONFIGURATION & BASE CLASSES
// ==================================================
export * from './configuration';
export * from './base';
export * from './common';

// ==================================================
// ALL API CLASSES (Professional Access)
// ==================================================
export * from './apis/analytics-api';
export * from './apis/authentication-api';
export * from './apis/bulk-operations-api';
export * from './apis/campaigns-api';
export * from './apis/database-api';
export * from './apis/domains-api';
export * from './apis/feature-flags-api';
export * from './apis/health-api';
export * from './apis/keyword-extraction-api';
export * from './apis/keyword-sets-api';
export * from './apis/management-api';
export * from './apis/monitoring-api';
export * from './apis/personas-api';
export * from './apis/proxies-api';
export * from './apis/proxy-pools-api';
export * from './apis/resources-api';
export * from './apis/server-settings-api';
export * from './apis/sse-api';
export * from './apis/validation-api';
export * from './apis/websocket-api';

// ==================================================
// ALL MODEL TYPES (Professional Access)
// ==================================================
export * from './models';

// ==================================================
// BULK EXPORTS (For Compatibility)
// ==================================================
export * from './api';

// ==================================================
// PROFESSIONAL API CLIENT (Recommended)
// ==================================================
export * from './unified-types';
export * from './unified-client';
export { apiClient } from './unified-client';

/* 
 * USAGE EXAMPLES:
 * 
 * ‚úÖ PROFESSIONAL (Individual API Classes):
 * import { AuthenticationApi, AnalyticsApi } from '@/lib/api-client';
 * 
 * ‚úÖ PROFESSIONAL (Unified Client):
 * import { apiClient, isSuccessResponse } from '@/lib/api-client';
 * 
 * ‚úÖ PROFESSIONAL (Specific Models):
 * import { ApiErrorInfo, SessionData } from '@/lib/api-client';
 * 
 * ‚úÖ PROFESSIONAL (Configuration):
 * import { Configuration } from '@/lib/api-client';
 * 
 * ‚ùå AMATEUR (Nested Imports):
 * import { AuthenticationApi } from '@/lib/api-client/apis/authentication-api';
 */
`;
}

/**
 * Fix the OpenAPI generator's garbage index.ts file
 */
function fixApiClientIndex() {
  try {
    console.log('üîß Fixing API client index.ts file...');
    
    // Generate professional index content
    const professionalIndex = generateProfessionalIndex();
    
    // Write the corrected index
    writeFileSync(INDEX_FILE, professionalIndex, 'utf8');
    
    console.log('‚úÖ API client index.ts fixed successfully!');
    console.log('üìã Now all APIs and models are properly exposed at the top level');
    
    // Show the improvement
    console.log('');
    console.log('‚úÖ Professional imports now work:');
    console.log('   import { AuthenticationApi, AnalyticsApi } from "@/lib/api-client"');
    console.log('   import { apiClient } from "@/lib/api-client"');
    console.log('   import { ApiErrorInfo, SessionData } from "@/lib/api-client"');
    console.log('');
    
  } catch (error) {
    console.error('‚ùå Failed to fix API client index:', error);
    process.exit(1);
  }
}

// Run the fix
fixApiClientIndex();
