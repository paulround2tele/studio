| Feature | Legacy Implementation (File:Function) | Phase Implementation (File:Function) | Gap Description | Concrete Migration Action | Confidence (R/A/G) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **config-hash/global offset** | `domain_generation_service.go:CreateCampaign` | `domain_generation.go:Configure` | The new service does not explicitly manage a global offset based on a configuration hash. | Implement a shared configuration store or service that can be accessed by the `domain_generation` service to manage and retrieve global offsets based on configuration hashes. | A |
| **per-batch transactions** | `domain_generation_service.go:ProcessGenerationCampaignBatch` | `domain_generation.go:executeGeneration` | The new service processes domains in batches but does not wrap each batch in a database transaction. | Wrap the domain storage logic within `executeGeneration` in a database transaction to ensure atomicity for each batch. | G |
| **audit logging** | `domain_generation_service.go:logAuditEvent` | `domain_generation.go:Configure` | Audit logging is present in the new service but is not as comprehensive as the legacy implementation. | Enhance the audit logging in the `domain_generation` service to include details about the configuration, execution, and completion of the domain generation phase. | G |
| **DB/connection metrics** | `domain_generation_service.go:DatabaseConnectionMetrics` | `domain_generation.go` | The new service does not have explicit database connection metrics. | Integrate a metrics recorder into the `domain_generation` service to capture and expose database connection and query performance metrics. | A |
| **optional Redis caching** | `domain_generation_service.go:NewDomainGenerationServiceWithCache` | `domain_generation.go` | The new service does not have built-in support for optional Redis caching. | Implement a caching layer in the `domain_generation` service that can be configured to use Redis for caching domain generation progress and results. | A |
| **worker pool** | `domain_generation_service.go:EfficientWorkerPool` | `dns_validation.go` | The new `dns_validation` service does not have a worker pool for concurrent domain validation. | Implement a worker pool in the `dns_validation` service to perform DNS lookups concurrently, improving performance. | A |
| **JSONB domains_data append semantics** | `campaign_store.go:AppendDomainsData` | `domain_generation.go:storeGeneratedDomains` | The new service stores generated domains but does not append to a JSONB field for efficient retrieval. | Implement a mechanism to append generated domains to a JSONB field in the campaign data, similar to the legacy `AppendDomainsData` function. | G |
| **SSE** | `sse_service.go` | Not Implemented | The new architecture does not have a direct equivalent for Server-Sent Events (SSE) for real-time updates. | Implement an event bus or a dedicated SSE service that can be used by the phase services to push real-time updates to clients. | R |
| **stealth integration** | `stealth_integration_service.go` | `stealth_aware_dns_validation.go`, `stealth_aware_http_validation.go` | Stealth features are being integrated into the new phase services but are not fully implemented. | Complete the integration of stealth features in the `dns_validation` and `http_validation` services, ensuring that they can operate in a stealthy manner when required. | A |
| **DI wiring** | `service_factory.go` | `domain_generation.go`, `dns_validation.go`, `http_validation.go` | The new services are not wired up with dependency injection, making them harder to test and maintain. | Implement a dependency injection framework to manage the dependencies of the new phase services, improving modularity and testability. | G |
