# Aggregated component schemas for modular spec bundling
# This file consolidates all schema definitions so components.schemas can $ref here.
SuccessEnvelope:
  type: object
  properties:
    success:
      type: boolean
      description: Always true for success envelopes.
      default: true
      example: true
      readOnly: true
    metadata:
      $ref: '#/Metadata'
    requestId:
      type: string
  required: [success, requestId]
ErrorEnvelope:
  type: object
  properties:
    success:
      type: boolean
      description: Always false for error envelopes.
      default: false
      example: false
      readOnly: true
    error:
      $ref: '#/ApiError'
    requestId:
      type: string
  required: [success, error, requestId]
ErrorCode:
  type: string
  description: Stable error code space
  enum:
    - BAD_REQUEST
    - UNAUTHORIZED
    - FORBIDDEN
    - NOT_FOUND
    - CONFLICT
    - VALIDATION_ERROR
    - REQUIRED_FIELD
    - RATE_LIMIT_EXCEEDED
    - REQUEST_TIMEOUT
    - NOT_IMPLEMENTED
    - INTERNAL_SERVER_ERROR
    - DATABASE_ERROR
    - SERVICE_UNAVAILABLE
    - GATEWAY_TIMEOUT
    - CAMPAIGN_IN_PROGRESS
    - QUOTA_EXCEEDED
    - INVALID_STATE
ApiError:
  type: object
  properties:
    code:
      $ref: '#/ErrorCode'
    message:
      type: string
    details:
      type: array
      items:
        type: object
        properties:
          field:
            type: string
            description: JSON pointer or field path
          code:
            $ref: '#/ErrorCode'
          message:
            type: string
          context:
            type: object
            additionalProperties: true
        required: [code, message]
    timestamp:
      type: string
      format: date-time
    path:
      type: string
  required: [code, message, timestamp]
Metadata:
  type: object
  properties:
    page:
      $ref: '#/Pagination'
    rateLimit:
      $ref: '#/RateLimitInfo'
    processing:
      $ref: '#/ProcessingInfo'
    bulk:
      $ref: '#/BulkOperationInfo'
    extra:
      type: object
      additionalProperties: {}
Pagination:
  type: object
  properties:
    current: { type: integer }
    total: { type: integer }
    pageSize: { type: integer }
    count: { type: integer }
RateLimitInfo:
  type: object
  properties:
    limit: { type: integer }
    remaining: { type: integer }
    reset: { type: string, format: date-time }
ProcessingInfo:
  type: object
  properties:
    duration: { type: string }
    version: { type: string }
BulkOperationInfo:
  type: object
  properties:
    processedItems: { type: integer }
    skippedItems: { type: integer }
    failedItems:
      type: array
      items: { type: string }
    processingTimeMs: { type: integer, format: int64 }
    totalRowsReturned: { type: integer, format: int64 }
    type: { type: string }
PersonaType:
  type: string
  enum: [dns, http]
ProxyProtocol:
  type: string
  enum: [http, https, socks5, socks4]
KeywordRuleType:
  type: string
  enum: [string, regex]

# Personas
CreatePersonaRequest:
  type: object
  properties:
    name: { type: string }
    personaType: { $ref: '#/PersonaType' }
    description: { type: string }
    configDetails:
      description: HTTP or DNS persona configuration object
      type: object
      additionalProperties: {}
    isEnabled: { type: boolean }
  required: [name, personaType, configDetails]
UpdatePersonaRequest:
  type: object
  properties:
    name: { type: string }
    description: { type: string }
    configDetails:
      type: object
      additionalProperties: {}
    isEnabled: { type: boolean }
PersonaResponse:
  type: object
  properties:
    id: { type: string, format: uuid }
    name: { type: string }
    personaType: { $ref: '#/PersonaType' }
    description: { type: string }
    configDetails: { type: object, additionalProperties: {} }
    isEnabled: { type: boolean }
    createdAt: { type: string, format: date-time }
    updatedAt: { type: string, format: date-time }
  required: [id, name, personaType, isEnabled, createdAt, updatedAt]
PersonaTestResponse:
  type: object
  properties:
    personaId: { type: string }
    personaType: { type: string }
    personaName: { type: string }
    success: { type: boolean }
    testPassed: { type: boolean }
    message: { type: string }
    testResults: { type: object }
    results: { type: object }
    timestamp: { type: string }
PersonaDeleteResponse:
  type: object
  properties:
    personaId: { type: string, format: uuid }
    deleted: { type: boolean }
    message: { type: string }
  required: [personaId, deleted]

# Proxies
CreateProxyRequestAPI:
  type: object
  properties:
    name: { type: string }
    description: { type: string }
    address: { type: string }
    protocol: { $ref: '#/ProxyProtocol' }
    username: { type: string }
    password: { type: string }
    countryCode: { type: string }
    isEnabled: { type: boolean }
    notes: { type: string }
  required: [name, address]
ProxyDetailsResponse:
  type: object
  properties:
    host: { type: string }
    port: { type: integer }
    protocol: { type: string }
    username: { type: string }
ProxyTestResponse:
  type: object
  properties:
    proxyId: { type: string, format: uuid }
    success: { type: boolean }
    statusCode: { type: integer }
    responseTime: { type: integer, format: int64 }
    error: { type: string }
UpdateProxyRequestAPI:
  type: object
  properties:
    name: { type: string }
    description: { type: string }
    address: { type: string }
    protocol: { $ref: '#/ProxyProtocol' }
    username: { type: string }
    password: { type: string }
    countryCode: { type: string }
    isEnabled: { type: boolean }
    notes: { type: string }
ProxyStatusResponse:
  type: object
  properties:
    proxyId: { type: string, format: uuid }
    status: { type: string }
    lastChecked: { type: string, format: date-time }
    responseTime: { type: integer, format: int64 }
    isHealthy: { type: boolean }
    proxyDetails: { $ref: '#/ProxyDetailsResponse' }
ProxyHealthCheckResponse:
  type: object
  properties:
    proxyId: { type: string, format: uuid }
    success: { type: boolean }
    status: { type: string }
    responseTime: { type: integer, format: int64 }
    message: { type: string }
    timestamp: { type: string, format: date-time }
BulkHealthCheckResponse:
  type: object
  properties:
    totalProxies: { type: integer }
    healthyProxies: { type: integer }
    failedProxies: { type: integer }
    results:
      type: array
      items: { $ref: '#/ProxyHealthCheckResponse' }
BulkProxyOperationResponse:
  type: object
  properties:
    totalRequested: { type: integer }
    successCount: { type: integer }
    errorCount: { type: integer }
    successfulProxies:
      type: array
      items: { type: string, format: uuid }
    failedProxies:
      type: array
      items:
        type: object
        properties:
          proxyId: { type: string, format: uuid }
          error: { type: string }
    results:
      type: array
      items:
        type: object
        additionalProperties: true
BulkUpdateProxiesRequest:
  type: object
  properties:
    proxyIds:
      type: array
      items: { type: string, format: uuid }
      minItems: 1
    updates: { $ref: '#/UpdateProxyRequestAPI' }
  required: [proxyIds, updates]
BulkDeleteProxiesRequest:
  type: object
  properties:
    proxyIds:
      type: array
      items: { type: string, format: uuid }
      minItems: 1
  required: [proxyIds]
BulkProxyTestResponse:
  type: object
  properties:
    totalRequested: { type: integer }
    successCount: { type: integer }
    errorCount: { type: integer }
    results:
      type: array
      items: { $ref: '#/ProxyTestResponse' }

# Proxy pools
ProxyPool:
  type: object
  properties:
    id: { type: string, format: uuid }
    name: { type: string }
    description: { type: string }
    isEnabled: { type: boolean }
    poolStrategy: { type: string }
    healthCheckEnabled: { type: boolean }
    healthCheckIntervalSeconds: { type: integer }
    maxRetries: { type: integer }
    timeoutSeconds: { type: integer }
    createdAt: { type: string, format: date-time }
    updatedAt: { type: string, format: date-time }
    proxies:
      type: array
      items: { type: object, additionalProperties: true }
ProxyPoolRequest:
  type: object
  properties:
    name: { type: string }
    description: { type: string }
    isEnabled: { type: boolean }
    poolStrategy: { type: string }
    healthCheckEnabled: { type: boolean }
    healthCheckIntervalSeconds: { type: integer }
    maxRetries: { type: integer }
    timeoutSeconds: { type: integer }
  required: [name]
ProxyPoolMembership:
  type: object
  properties:
    poolId: { type: string, format: uuid }
    proxyId: { type: string, format: uuid }
    weight: { type: integer }
    isActive: { type: boolean }
    addedAt: { type: string, format: date-time }
ProxyPoolMembershipResponse:
  type: object
  properties:
    poolId: { type: string, format: uuid }
    proxyId: { type: string, format: uuid }
    added: { type: boolean }
    removed: { type: boolean }
    message: { type: string }
ProxyPoolDeleteResponse:
  type: object
  properties:
    deleted: { type: boolean }
    poolId: { type: string, format: uuid }
    message: { type: string }

# Keyword sets / rules
KeywordRuleRequest:
  type: object
  properties:
    pattern: { type: string }
    ruleType: { $ref: '#/KeywordRuleType' }
    isCaseSensitive: { type: boolean }
    category: { type: string }
    contextChars: { type: integer }
  required: [pattern, ruleType]
CreateKeywordSetRequest:
  type: object
  properties:
    name: { type: string }
    description: { type: string }
    isEnabled: { type: boolean }
    rules:
      type: array
      items: { $ref: '#/KeywordRuleRequest' }
  required: [name]
KeywordRuleDTO:
  type: object
  properties:
    id: { type: string, format: uuid }
    keywordSetId: { type: string, format: uuid }
    pattern: { type: string }
    ruleType: { type: string }
    isCaseSensitive: { type: boolean }
    category: { type: string }
    contextChars: { type: integer }
    createdAt: { type: string, format: date-time }
    updatedAt: { type: string, format: date-time }
KeywordSetResponse:
  type: object
  properties:
    id: { type: string, format: uuid }
    name: { type: string }
    description: { type: string }
    isEnabled: { type: boolean }
    createdAt: { type: string, format: date-time }
    updatedAt: { type: string, format: date-time }
    rules:
      type: array
      items: { $ref: '#/KeywordRuleDTO' }
    ruleCount: { type: integer }
  required: [id, name, isEnabled, createdAt, updatedAt, ruleCount]
UpdateKeywordSetRequest:
  type: object
  properties:
    name: { type: string }
    description: { type: string }
    isEnabled: { type: boolean }
    rules:
      type: array
      items: { $ref: '#/KeywordRuleRequest' }
KeywordSetWithRulesResponse:
  type: object
  properties:
    id: { type: string, format: uuid }
    name: { type: string }
    description: { type: string }
    isEnabled: { type: boolean }
    createdAt: { type: string, format: date-time }
    updatedAt: { type: string, format: date-time }
    rules:
      type: array
      items: { $ref: '#/KeywordRuleDTO' }
    ruleCount: { type: integer }
  required: [id, name, isEnabled, createdAt, updatedAt, rules, ruleCount]

# Extraction
BatchKeywordExtractionRequest:
  type: object
  properties:
    items:
      type: array
      items:
        type: object
        properties:
          url: { type: string, format: uri }
          keywordSetId: { type: string, format: uuid }
          httpPersonaId: { type: string, format: uuid }
          dnsPersonaId: { type: string, format: uuid }
        required: [url, keywordSetId]
  required: [items]
BatchKeywordExtractionResponse:
  type: object
  properties:
    results:
      type: array
      items:
        type: object
        properties:
          url: { type: string, format: uri }
          keywordSetIdUsed: { type: string, format: uuid }
          httpPersonaIdUsed: { type: string, format: uuid }
          dnsPersonaIdUsed: { type: string, format: uuid }
          proxyIdUsed: { type: string, format: uuid }
          finalURL: { type: string, format: uri }
          statusCode: { type: integer }
          matches:
            type: array
            items:
              type: object
              properties:
                matchedPattern: { type: string }
                matchedText: { type: string }
                category: { type: string }
                contexts:
                  type: array
                  items: { type: string }
          error: { type: string }

# Database bulk
BulkDatabaseQueryRequest:
  type: object
  properties:
    queries:
      type: array
      items:
        type: object
        properties:
          id: { type: string }
          sql: { type: string }
        required: [id, sql]
    limit: { type: integer }
    timeout: { type: integer }
  required: [queries]
BulkDatabaseQueryResponse:
  type: object
  properties:
    results:
      type: object
      additionalProperties:
        type: object
        properties:
          columns: { type: array, items: { type: string } }
          rows:
            type: array
            items:
              type: array
              items:
                $ref: '#/DatabaseValue'
          rowCount: { type: integer }
          executionTime: { type: integer, format: int64 }
          success: { type: boolean }
          error: { type: string }
    totalCount: { type: integer }
DatabaseValue:
  type: object
  properties:
    stringValue: { type: string }
    intValue: { type: integer, format: int64 }
    floatValue: { type: number }
    boolValue: { type: boolean }
    isNull: { type: boolean }
    rawValue: { type: string }
# Database stats
BulkDatabaseStatsRequest:
  type: object
  properties:
    schemas:
      type: array
      items: { type: string }
    tables:
      type: array
      items: { type: string }
    includeIndexes: { type: boolean }
    includeSize: { type: boolean }
  additionalProperties: false
BulkDatabaseStatsResponse:
  type: object
  properties:
    databaseStats: { $ref: '#/DatabaseStats' }
    schemaStats:
      type: object
      additionalProperties:
        $ref: '#/SchemaStats'
    tableStats:
      type: object
      additionalProperties:
        $ref: '#/TableStats'
    totalCount: { type: integer }
DatabaseStats:
  description: Overall database statistics
  type: object
  properties:
    totalTables: { type: integer }
    totalUsers: { type: integer }
    totalSessions: { type: integer }
    databaseSize: { type: string }
    schemaVersion: { type: string }
    uptime: { type: string }
    version: { type: string }
    isHealthy: { type: boolean }
SchemaStats:
  description: Statistics for a specific database schema
  type: object
  properties:
    name: { type: string }
    tableCount: { type: integer }
    totalRows: { type: integer }
    totalSize: { type: string }
TableStats:
  description: Statistics for a specific table
  type: object
  properties:
    name: { type: string }
    rowCount: { type: integer }
    size: { type: string }
    indexes: { type: array, items: { type: string } }

# Config schemas
AuthConfig:
  type: object
  description: Authentication configuration
  additionalProperties: true
LoggingConfig:
  type: object
  description: Logging configuration
  additionalProperties: true
DNSValidatorConfigJSON:
  type: object
  description: DNS validator configuration
  additionalProperties: true
HTTPValidatorConfigJSON:
  type: object
  description: HTTP validator configuration
  additionalProperties: true
WorkerConfig:
  type: object
  description: Worker configuration
  additionalProperties: true
WorkerConfigUpdate:
  type: object
  description: Worker configuration update payload
  properties:
    poolSize:
      type: integer
      minimum: 1
      maximum: 1000
      description: Number of worker threads in the pool
    maxJobs:
      type: integer
      minimum: 1
      maximum: 10000
      description: Maximum number of jobs in queue
    jobTimeout:
      type: integer
      minimum: 1
      maximum: 3600
      description: Job execution timeout in seconds
    idleTimeout:
      type: integer
      minimum: 1
      maximum: 300
      description: Worker idle timeout in seconds
    retryAttempts:
      type: integer
      minimum: 0
      maximum: 10
      description: Number of retry attempts for failed jobs
    retryDelay:
      type: integer
      minimum: 100
      maximum: 60000
      description: Delay between retries in milliseconds
    enableMetrics:
      type: boolean
      description: Enable worker performance metrics collection
    metricsInterval:
      type: integer
      minimum: 1
      maximum: 3600
      description: Metrics collection interval in seconds
    priority:
      type: string
      enum: [low, normal, high, critical]
      description: Worker pool priority level
    enableHealthChecks:
      type: boolean
      description: Enable worker health monitoring
    healthCheckInterval:
      type: integer
      minimum: 5
      maximum: 300
      description: Health check interval in seconds
RateLimiterConfig:
  type: object
  description: Rate limiter configuration
  additionalProperties: true
ProxyManagerConfigJSON:
  type: object
  description: Proxy manager configuration
  additionalProperties: true
ServerConfigResponse:
  type: object
  description: Consolidated server configuration response
  additionalProperties: true
ServerConfigUpdateRequest:
  type: object
  description: Server configuration update request
  additionalProperties: true

# Feature flags
FeatureFlags:
  type: object
  description: Feature flags map
  additionalProperties:
    type: boolean
